#!/bin/sh
set -e
set -x

# "invoke" extension for Jim.
gcc -I.  -I"/secure/SecureNotes/Tcl_Evolution/jimsh"    -pipe -g3 -O0 -Wall -fPIC -std=c11 -c -o invokeNative.o  invokeNative.c

gcc -pipe -g3 -O0 -Wall -fPIC -std=c11 -Wl,--export-dynamic  -shared -o invokeNative.so  invokeNative.o  /usr/lib/x86_64-linux-gnu/libffi.a 

# invokeTestLib.so
gcc -I.  -pipe -g3 -O0 -Wall -fPIC -std=c11 -c -o invokeTestLib.o  invokeTestLib.c

gcc -pipe -g3 -O0 -Wall -fPIC -std=c11 -Wl,--export-dynamic  -shared -o invokeTestLib.so  invokeTestLib.o 

# test runs
./jimsh  test.tcl

valgrind  -q  ./jimsh  test.tcl
