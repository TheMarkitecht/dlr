#!/bin/sh
set -e
set -x

# "dlr" extension for Jim.
gcc -I.  -I"../jimsh"    -pipe -g3 -O0 -Wall -fPIC -std=c11 -c -o dlrNative.o  dlrNative.c

gcc -pipe -g3 -O0 -Wall -fPIC -std=c11 -Wl,--export-dynamic  -shared -o dlrNative.so  dlrNative.o  /usr/lib/x86_64-linux-gnu/libffi.a 

# dlrTestLib.so
gcc -I.  -pipe -g3 -O0 -Wall -fPIC -std=c11 -c -o dlrTestLib.o  dlrTestLib.c

gcc -pipe -g3 -O0 -Wall -fPIC -std=c11 -Wl,--export-dynamic  -shared -o dlrTestLib.so  dlrTestLib.o 

# test runs
./jimsh  test.tcl

valgrind  -q  --leak-check=full  --leak-resolution=high  \
    --show-leak-kinds=definite,possible  --errors-for-leak-kinds=definite,possible  \
    ./jimsh  test.tcl

# time ./jimsh bench.tcl
